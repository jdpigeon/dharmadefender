"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Observable_1 = require("rxjs/Observable");
var muse_1 = require("./../muse");
require("rxjs/add/observable/from");
require("rxjs/add/operator/mergeMap");
require("rxjs/add/operator/concat");
;
function zipSamples(eegReadings) {
    var buffer = [];
    var lastTimestamp = null;
    return eegReadings
        .mergeMap(function (reading) {
        if (reading.timestamp !== lastTimestamp) {
            lastTimestamp = reading.timestamp;
            if (buffer.length) {
                var result = Observable_1.Observable.from([buffer.slice()]);
                buffer.splice(0, buffer.length, reading);
                return result;
            }
        }
        buffer.push(reading);
        return Observable_1.Observable.from([]);
    })
        .concat(Observable_1.Observable.from([buffer]))
        .mergeMap(function (readings) {
        var result = readings[0].samples.map(function (x, index) {
            var data = [NaN, NaN, NaN, NaN, NaN];
            for (var _i = 0, readings_1 = readings; _i < readings_1.length; _i++) {
                var reading = readings_1[_i];
                data[reading.electrode] = reading.samples[index];
            }
            return {
                index: readings[0].index,
                timestamp: readings[0].timestamp + index * 1000. / muse_1.EEG_FREQUENCY,
                data: data
            };
        });
        return Observable_1.Observable.from(result);
    });
}
exports.zipSamples = zipSamples;
//# sourceMappingURL=zip-samples.js.map